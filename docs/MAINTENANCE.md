# YaoXiang 文档维护规范

> 版本：v1.0.0
> 状态：正式
> 作者：晨煦
> 日期：2025-01-04

---

## 一、维护原则

### 1.1 核心目标

- **一致性**：所有文档与代码实现保持同步
- **可用性**：代码示例可运行，用户可快速上手
- **可维护性**：清晰的规则和流程，降低维护成本
- **可追溯性**：版本号与代码版本对应，支持回溯

### 1.2 文档分级

| 级别 | 文档类型 | 更新频率 | 负责人 |
|------|---------|---------|--------|
| **L1 - 核心** | 语言规范、编译器设计、运行时设计 | 代码变更时同步 | 核心开发者 |
| **L2 - 重要** | 项目结构、快速入门、API 文档 | 每周审查 | 文档维护者 |
| **L3 - 参考** | 设计宣言、白皮书、指南 | 每月审查 | 社区贡献者 |
| **L4 - 历史** | 已归档文档、废弃规范 | 不定期 | 维护者 |

---

## 二、版本管理规范

### 2.1 版本号规则

```
主版本.次版本.修订版本
  │       │       └── 文档小幅修订（错别字、格式）
  │       └─────── 文档内容更新（新增章节、示例）
  └─────────────── 架构重大变更
```

**版本号对应规则**：
- 当 `src/` 目录下的核心模块（lexer、parser、typecheck、vm、runtime）发生重大变更时，架构文档主版本 +1
- 当新增模块或删除模块时，架构文档次版本 +1
- 当文档描述的细节需要更正时，修订版本 +1

### 2.2 版本标注

所有正式文档必须在顶部标注版本信息：

```markdown
> 版本：v2.0.0
> 状态：[正式|草稿|已归档]
> 作者：沫郁酱
> 日期：2025-01-04
> 更新：[更新说明]
```

### 2.3 版本历史

每个文档底部必须包含版本历史：

```markdown
---

## 版本历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|---------|
| v1.0.0 | 2025-01-04 | 沫郁酱 | 初始版本 |
| v1.1.0 | 2025-01-05 | 沫郁酱 | 新增章节 X |
| v2.0.0 | 2025-01-06 | 沫郁酱 | 重大重构，与代码保持一致 |

---

**最后更新**：2025-01-06
**维护者**：沫郁酱
```

---

## 三、触发更新规则

### 3.1 必须更新文档的情况

| 触发条件 | 影响文档 | 更新时限 |
|---------|---------|---------|
| 新增语言关键字/语法 | 语言规范、编译器设计、快速入门 | 1 周内 |
| 新增模块或文件 | 项目结构、相关架构文档 | 3 天内 |
| 删除/重命名模块 | 项目结构、架构文档 | 即时 |
| 算法重大优化 | 相关架构文档 | 1 周内 |
| API 变更 | API 文档、快速入门 | 1 周内 |
| 性能目标变更 | 架构文档性能章节 | 1 周内 |

### 3.2 建议更新文档的情况

- 代码风格指南变更
- 开发工具链更新
- 贡献流程变更
- 社区反馈的文档问题

### 3.3 更新触发检查清单

在提交代码前，请检查以下事项：

```markdown
## 代码变更检查清单

- [ ] 本次变更是否涉及新关键字？
- [ ] 本次变更是否新增模块？
- [ ] 本次变更是否修改 API？
- [ ] 本次变更是否影响性能目标？
- [ ] 是否需要更新相关文档？
```

---

## 四、文档质量标准

### 4.1 代码示例要求

**必须满足**：
- ✅ 可直接运行（无语法错误）
- ✅ 语法与当前语言版本一致
- ✅ 使用类型集中约定（推荐）
- ✅ 包含必要的注释

**禁止使用**：
- ❌ 已废弃的语法
- ❌ 与代码实现不符的示例
- ❌ 伪代码或占位符

### 4.2 文档格式要求

- ✅ 统一使用中文标题
- ✅ 代码块标注语言（yaoxiang、rust、bash）
- ✅ 关键概念使用加粗
- ✅ 表格用于对比和枚举
- ✅ 术语表用于新概念

### 4.3 术语一致性

| 术语 | 英文 | 说明 |
|------|------|------|
| 并作 | Spawn | YaoXiang 的异步并发模型 |
| 并作图 | DAG | Directed Acyclic Graph，依赖关系图 |
| 位置绑定 | Positional Binding | `[n]` 语法控制参数绑定 |
| 类型集中 | Type-Centric | 声明中包含完整类型信息的约定 |
| Pratt Parser | Pratt Parser | 表达式优先级解析器 |

---

## 五、审查流程

### 5.1 文档审查触发

**自动触发**（PR 中包含 docs/ 目录变更）
**手动触发**（代码变更涉及核心模块）

### 5.2 审查清单

```markdown
## 文档审查清单

### 内容审查
- [ ] 代码示例可运行
- [ ] 语法与实现一致
- [ ] 术语使用正确
- [ ] 版本号已更新

### 格式审查
- [ ] 标题层级正确
- [ ] 代码块标注语言
- [ ] 链接有效
- [ ] 无错别字

### 完整性审查
- [ ] 相关章节已覆盖
- [ ] 交叉引用正确
- [ ] 版本历史已更新
```

### 5.3 审查责任

| 文档级别 | 审查者 |
|---------|-------|
| L1 - 核心 | 核心团队至少 2 人 |
| L2 - 重要 | 核心团队 1 人 + 文档维护者 |
| L3 - 参考 | 文档维护者 |
| L4 - 历史 | 维护者（可选） |

---

## 六、文档测试

### 6.1 示例代码测试

**目标**：确保文档中的代码示例可运行

**实现方式**：
1. 将可运行示例提取到 `docs/examples/`
2. 使用 CI 定期运行示例
3. 标记不可运行的示例为「⚠️ 待验证」

### 6.2 链接测试

**目标**：确保文档中的链接有效

**实现方式**：
- CI 中使用 Markdown 链接检查工具
- 检查范围：docs/ 目录下所有 .md 文件

### 6.3 拼写检查

**目标**：避免错别字影响阅读

**实现方式**：
- CI 中使用拼写检查工具
- 重点检查：术语拼写、代码标识符

---

## 七、归档管理

### 7.1 归档条件

以下情况应将文档归档：

- ✅ 被新文档完全取代
- ✅ 内容严重过时且无参考价值
- ✅ 项目不再使用该功能
- ✅ 社区不再维护该文档

### 7.2 归档流程

1. 将文档移至 `docs/works/old/archived/`
2. 在文档顶部添加归档标记：

```markdown
> 状态：[已归档]
> 归档日期：2025-01-04
> **⚠️ 归档说明**：本文档...[说明原因]
```

3. 在原位置创建重定向说明

### 7.3 归档文档处理

- ✅ 保留有历史价值的文档
- ❌ 删除重复或无意义的草稿
- ✅ 定期清理（每季度一次）

---

## 八、工具与自动化

### 8.1 推荐工具

| 工具 | 用途 |
|------|------|
| markdown-link-check | 链接有效性检查 |
| vale | 写作风格检查 |
| cspell | 拼写检查 |
| cargo-test | 代码示例测试 |

### 8.2 CI 集成示例

```yaml
# .github/workflows/docs.yml
name: Documentation

on:
  push:
    paths:
      - 'docs/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Check links
        run: |
          npm install -g markdown-link-check
          find docs -name "*.md" -exec markdown-link-check {} \;

      - name: Spell check
        run: |
          npm install -g cspell
          cspell "docs/**/*.md"

      - name: Run examples
        run: |
          cargo build --release
          for f in docs/examples/*.yx; do
            ./target/release/yaoxiang "$f"
          done
```

---

## 九、角色与职责

### 9.1 文档维护者

- **职责**：维护 L2、L3 级文档
- **权限**：直接修改 docs/ 目录下的文档
- **要求**：熟悉项目结构，良好的写作能力

### 9.2 核心开发者

- **职责**：维护 L1 级文档
- **权限**：修改所有文档，审核 L1 级变更
- **要求**：深入理解编译器、运行时设计

### 9.3 社区贡献者

- **职责**：报告文档问题，提交修复
- **权限**：提交 PR 修改文档
- **要求**：遵循贡献指南

---

## 十、相关文档

- [项目结构](architecture/project-structure.md)
- [编译器设计](architecture/compiler-design.md)
- [运行时设计](architecture/runtime-design.md)
- [贡献指南](guides/dev/)
- [提交规范](guides/dev/commit-convention.md)

---

**最后更新**：2025-01-04
**维护者**：沫郁酱
**下次审查**：2025-04-04
