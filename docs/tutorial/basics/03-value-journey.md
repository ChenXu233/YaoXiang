---
title: 第三章：值的旅程
---

# 第三章：值的旅程

> 本章目标：理解变量、赋值、作用域，理解数据在内存中的生命周期

## 3.1 什么是变量？

**变量**，就是数据的"名字"。

想象你有很多个抽屉，每个抽屉可以放东西。你给抽屉贴上名字，这就是变量。

```yaoxiang
# 创建一个变量，名字叫 "age"，值是 25
age: Int = 25

# 创建一个变量，名字叫 "name"，值是 "小明"
name: String = "小明"
```

**理解**：
- `age` 是变量的**名字**
- `Int` 是变量的**类型**
- `25` 是变量的**值**

```
┌─────────────────────────────────────────┐
│                 内存                     │
│  ┌─────────┐      ┌─────────┐        │
│  │  名字   │ ────▶ │  值     │        │
│  │  age   │      │   25    │        │
│  └─────────┘      └─────────┘        │
│  ┌─────────┐      ┌─────────┐        │
│  │  name  │ ────▶ │ "小明"  │        │
│  └─────────┘      └─────────┘        │
└─────────────────────────────────────────┘
```


## 3.2 赋值

**赋值**，就是把值放进变量的过程：

```yaoxiang
# 第一次赋值（初始化）
age: Int = 18

# 重新赋值（改变变量的值）
age = 20
age = 25
```

**重要规则**：
- 第一次赋值叫做**初始化**
- 重新赋值会**覆盖**原来的值
- 赋值后，旧值就"消失"了（除非你复制了一份）


## 3.3 变量的名字

变量名字可以自己取，但要遵守规则：

| 规则 | 正确例子 | 错误例子 |
|------|----------|----------|
| 以字母或下划线开头 | `age`、`_count`、`name1` | `1age`、`$name` |
| 后面可以跟字母、数字、下划线 | `age1`、`count_2` | `age!`、`name@` |
| 大小写敏感 | `Age` 和 `age` 是不同的 | - |
| 不能用关键字 | `if`、`while`、`return` | - |

**好的命名习惯**：

```yaoxiang
# ✅ 好的名字（有意义）
user_age = 18
total_price = 99.99
is_valid = true

# ❌ 不好的名字（看不出用途）
a = 18
x1 = 99.99
flag = true
```


## 3.4 什么是作用域？

**作用域**，就是变量"能使用"的区域。

想象每个房间是一个作用域，变量只能在它出生的那个房间里使用：

```yaoxiang
# 全局作用域（整个文件都能用）
global_var: Int = 100

my_function: () -> Void = {
    # 局部作用域（只有这个函数里能用）
    local_var: Int = 50
    print(global_var)    # ✅ 可以使用
    print(local_var)     # ✅ 可以使用
}

# print(local_var)      # ❌ 错误！在外面不能用
```

**示意图**：

```
┌─────────────────────────────────────────┐
│              全局作用域                   │
│  global_var = 100                       │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │    my_function 局部作用域         │   │
│  │    local_var = 50                │   │
│  │    可以用 global_var 和 local_var │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │    另一个局部作用域               │   │
│  │    不能用 local_var              │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

## 3.5 值的生命周期

**生命周期**，就是一个值从"出生"到"死亡"的过程：

```yaoxiang
create_value: () -> Void = {
    # 值"出生"
    number: Int = 42
    print(number)        # 可以使用

    # 值在这里"死亡"（函数结束）
}

# number 在这里已经不存在了
```

**规则**：
- 变量在它所在的作用域**结束时死亡**
- 死亡后，这个变量就不能再使用了

## 3.6 可变与不可变

变量可以是**可变的**（能改）或**不可变的**（不能改）：

```yaoxiang
# 不可变变量（默认）
age: Int = 18
# age = 20      # ❌ 错误！不能重新赋值

# 可变变量（需要加 mut）
mut counter: Int = 0
counter = counter + 1   # ✅ 可以改
counter = counter + 1   # ✅ 可以改
```

**3.6.1 字段级别的不可变性**

YaoXiang 的不可变性是**字段级别**的，不是对象级别：

```yaoxiang
# Person 类型
Person: Type = {
    name: String,       # 不可变字段
    mut age: Int,       # 可变字段
    mut score: Float    # 可变字段
}

# 使用
person: Person = Person("小明", 18, 95.5)

# person.name = "小红"    # ❌ 错误！name 是不可变字段
person.age = 19           # ✅ 可以改
person.score = 98.0       # ✅ 可以改
```

**为什么字段级别？**

| 级别 | 安全性 | 灵活性 |
|------|--------|--------|
| 对象级别 mut | 较弱 | 较强 |
| **字段级别 mut** | **更强** | **足够** |

- **更安全**：只有需要改的字段才能改
- **更清晰**：一眼看出哪些字段可变
- **绝对安全**：编译期检查，运行时保证

**3.6.2 什么时候用可变？什么时候用不可变？**

| 情况 | 推荐 |
|------|------|
| 值不需要改变 | **不可变**（更安全） |
| 值需要频繁改变 | **可变字段**（mut） |
| 不确定时 | **不可变**（默认选择） |


## 3.7 常量

**常量**，就是固定不变的值：

```yaoxiang
# 常量（一旦定义，永远不变）
PI: Float = 3.14159
MAX_SIZE: Int = 100

# 常量的特点：
# 1. 不能重新赋值
# 2. 通常用大写字母命名（习惯）
```

## 3.8 本章小结

| 概念 | 理解 |
|------|------|
| 变量 | 给值取的名字 |
| 赋值 | 把值放进变量的过程 |
| 作用域 | 变量能使用的区域 |
| 生命周期 | 值从出生到死亡的过程 |
| mut（可变） | 变量可以重新赋值 |
| 字段级别 mut | 只有标记 mut 的字段才能修改 |
| 不可变 | 不能改变值的变量 |
| 常量 | 固定不变的值 |

## 3.9 易经引言

> 「夫乾，其静也专，其动也直，是以大生焉。
>  夫坤，其静也翕，其动也辟，是以广生焉。」
> —— 《周易·系辞上传》
>
> 乾卦静时专一，动时刚直；坤卦静时收敛，动时开放。
> 变量亦如阴阳——有的静而专一（不可变），有的动而灵活（可变）。
> 懂得何时该"静"，何时该"动"，方能写出好的程序。
